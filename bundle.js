(()=>{var e={6658:e=>{e.exports={host:"127.0.0.1",port:80,keys:["some secret here"],db:{path:"127.0.0.1",port:"27017",name:"resume"},session:{key:"koa:sess",maxAge:864e5,autoCommit:!0,overwrite:!0,httpOnly:!0,signed:!0,rolling:!0,renew:!1,sameSite:null},DirectAccess:["/message","/api/login","/socket.io"],JWTAccess:["/api/users/find","/api/upload/avatar","/api/tickets","/api/tickets/add","/api/tickets/query"],TokenKey:"authorization",secret:"some secret here"}},9575:(e,t,s)=>{const{MongoClient:o,ObjectId:n}=s(7548),a=s(6658);class r{static instance(){return this._instance||(this._instance=new r),this._instance}constructor(){this.client=null,this.connect()}connect(){let e=this,t=`mongodb://${a.db.path}:${a.db.port}/${a.db.name}`;return new Promise(((s,n)=>{this.client?s(this.client):o.connect(t,{useUnifiedTopology:!0},(function(t,o){if(t)return void n(t);let r=o.db(a.db.name);e.client=r,s(r)}))}))}insert(e,t){return new Promise(((s,o)=>{this.connect().then((n=>{n.collection(e).insertOne(t,((e,t)=>{e?o(e):s(t)}))}))}))}remove(e,t){return new Promise(((s,o)=>{this.connect().then((n=>{n.collection(e).removeOne(t,((e,t)=>{e?o(e):s(t)}))}))}))}clear(e,t){return new Promise(((s,o)=>{this.connect().then((n=>{n.collection(e).removeMany(t,((e,t)=>{e?o(e):s(t)}))}))}))}update(e,t,s,o){return new Promise(((n,a)=>{this.connect().then((r=>{r.collection(e).updateOne(t,{$set:s},o,((e,t)=>{e?a(e):n(t)}))}))}))}modify(e,t,s,o){return new Promise(((n,a)=>{this.connect().then((r=>{r.collection(e).updateMany(t,{$set:s},o,((e,t)=>{e?a(e):n(t)}))}))}))}find(e,t){return new Promise(((s,o)=>{this.connect().then((function(n){n.collection(e).find(t).toArray((function(e,t){e?o(e):s(t)}))}))}))}ObjectId(e){return n(e)}Find_id(e,t){let s=t||"_id";return"string"==typeof e[s]&&(e[s]=this.ObjectId(e[s])),"object"==typeof e[s]&&Object.keys(e[s]).forEach(((t,o)=>{e[s][t]=this.ObjectId(e[s][t])})),e||{}}}e.exports=r},1174:(e,t,s)=>{const o=s(6757)(),n=s(4095);o.use("/api",n.routes()),o.get("/render",(async e=>{await e.render("render",{name:"zhanggp",password:"123456"})})),e.exports=o},4095:(e,t,s)=>{const o=s(6757)(),n=s(5072),a=s(7391),r=s(9862),i=s(9548),c=s(5764),d=s(5616),u=s(9024),l=s(4649),p=s(663),y=s(7331),m=s(5218),h=s(4536),b=s(174),f=s(3895),w=s(3896),g=s(7240),_=s(778);o.use("/index",n.routes()),o.use("/render",a.routes()),o.use("/setting",r.routes()),o.use("/login",i.routes()),o.use("/users",c.routes()),o.use("/roles",d.routes()),o.use("/menus",u.routes()),o.use("/dialog",l.routes()),o.use("/upload",p.routes()),o.use("/download",y.routes()),o.use("/category",m.routes()),o.use("/config",h.routes()),o.use("/goods",b.routes()),o.use("/tickets",f.routes()),o.use("/ebook",w.routes()),o.use("/address",g.routes()),o.use("/codegen",_.routes()),e.exports=o},7240:(e,t,s)=>{const o=s(6757)(),n=s(9575).instance(),a=s(9515),r="shipping-address";o.post("/",(async e=>{let{_id:t}=e.request.body;await n.find(r,{user:t}).then((t=>{e.body=t}))})),o.post("/add",(async e=>{let t=e.request.body;await n.insert(r,{...t}).then((t=>{e.body=t}))})),o.post("/del",(async e=>{let{_id:t}=e.request.body;await n.remove(r,{_id:n.ObjectId(t)}).then((t=>{e.body=t}))})),o.post("/edit",(async e=>{const t=e.request.body,{_id:s}=t;let o=a.Omit(t,["_id"]);await n.update(r,{_id:n.ObjectId(s)},o).then((t=>{e.body=t}))})),e.exports=o},5218:(e,t,s)=>{const o=s(6757)(),n=s(9575).instance(),a=s(9515),r="category";o.get("/all",(async e=>{const{tree:t}=e.request.query;await n.find(r,{}).then((s=>{if("tree"===t){const t=a.Tree.root(s),o=t[0],n=t[1];a.Tree.loop(o,n),e.body=o}else e.body=s}))})),o.post("/add",(async e=>{let t=e.request.body;await n.insert(r,{...t,key:(new Date).getTime().toString()}).then((t=>{e.body=t}))})),o.post("/del",(async e=>{let{_id:t}=e.request.body;await n.remove(r,{_id:n.ObjectId(t)}).then((t=>{e.body=t}))})),o.post("/edit",(async e=>{const t=e.request.body,{_id:s}=t;let o=a.Omit(t,["_id"]);await n.update(r,{_id:n.ObjectId(s)},o).then((t=>{e.body=t}))})),o.post("/find",(async e=>{let{_id:t}=e.request.body;await n.find(r,{_id:n.ObjectId(t)}).then((t=>{e.body=t}))})),e.exports=o},778:(e,t,o)=>{const n=o(5747),a=o(5622),r=o(6757)(),i=o(85),c=o(366),d=o(6658),u=o(9515);r.post("/parse",(async e=>{const t=e.request.body,s=JSON.parse(t.map),o=e.request.files.file,n=i.parse(o.path);let a=[];const r=n[0].data,c=r[0];let d=[],u={};c.forEach((e=>{u[s[e]||e]="",d.push(s[e]||e)})),r.slice(1).forEach((e=>{let t={...u};e.forEach(((e,s)=>Object.assign(t,{[d[s]]:e}))),a.push(t)})),e.body=a})),r.post("/dblink",(async e=>{const t=e.request.body,{type:s,name:o}=t;switch(s){case"mysql":const s=c.createConnection({host:t.host,port:t.port,user:t.user,password:t.secret,database:t.name});try{s.connect()}catch(t){e.body={error:t}}let a=new Array,r={};function n(e,t){return new Promise(((s,o)=>{t.query(e,(function(e,t,o){s({error:e,results:t,fields:o})}))}))}await n("show tables",s).then((async({results:e})=>{if(e)for(var t=0;t<e.length;t++){a[t]=e[t];const i=a[t];let c="";c+=i["Tables_in_"+o],await n("select * from "+c,s).then((({fields:e})=>{r[i["Tables_in_"+o]]=e}))}})),s.end(),e.body=r}})),r.post("/vue/template",(async e=>{let t=[];n.readdirSync(a.join(__dirname+"/../../../template/vue")).forEach((e=>{t.push(`http://${d.host}:${d.port}/template/${e}`)})),e.body=t})),r.post("/upload/template",(async e=>{const t=e.request.files.file,s=e.request.body.type,o=n.createReadStream(t.path);let r=u.GetKey(36,10)+"-"+(new Date).getTime()+"-"+t.name,i=a.join(__dirname,`../../../template/${s}/`)+r;const c=n.createWriteStream(i);o.pipe(c),e.body={status:1,message:"模板上传成功！",path:`http://${d.host}:${d.port}/template/${r}`}})),r.post("/create",(async e=>{const{type:t,name:o,template:r,data:i}=e.request.body;let c=a.join(__dirname,`../../../template/${t.toLowerCase()}/${r}`),d=n.createReadStream(c);await new Promise(((e,t)=>{let s=[];d.on("data",(function(e){s.push(e)})),d.on("end",(function(){e(s)}))})).then((t=>{let o=JSON.parse(i).fields;s=u.SSRParse(t,o),e.body=s}))})),e.exports=r},4536:(e,t,s)=>{const o=s(5747),n=s(5622),a=s(6757)(),r=s(9575).instance(),i=s(6658),c=(s(9515),"config");a.post("/get/carousel",(async e=>{let t=[];o.readdirSync(n.join(__dirname+"/../../../files/carousel")).forEach((e=>{t.push(`http://${i.host}:${i.port}/carousel/${e}`)})),e.body=t})),a.post("/remove/carousel",(async e=>{let{name:t}=e.request.body;const s=n.join(__dirname+"/../../../files/carousel/"+t);o.existsSync(s)?(o.unlinkSync(s),e.body={status:1,message:t+"已删除！"}):e.body="文件不存在！"})),a.post("/set",(async e=>{let t=e.request.body;t.key?await r.update(c,{key:t.key},t,{upsert:!0}).then((t=>{e.body=t})):e.body="更新失败，原因：未传递正确的参数key"})),a.post("/get",(async e=>{let{key:t}=e.request.body;t?await r.find(c,{key:t}).then((t=>{e.body=t})):e.body="获取失败，原因：未传入正确的参数key"})),e.exports=a},4649:(e,t,s)=>{const o=s(8614),n=s(6757)(),a=s(2470),{Duplex:r}=s(2413),i=s(9575).instance(),c="dialog",d=new o.EventEmitter,u=(new r({read(e){},write(e,t,s){}}),(e,t,s)=>e.push(`retry: 360000\nevent:${t}\ndata: ${s}\n\n`));d.setMaxListeners(0),n.get("/",(async e=>{let{_id:t,name:s}=e.session.UserInfo,o=new r({read(e){console.log("数据被读取了")},write(e,t,s){console.log("数据被修改了")}});e.status=200,e.set({"Access-Control-Allow-Origin":"*","Content-Type":"text/event-stream;charset=utf-8","Cache-Control":"no-cache",Connection:"keep-alive"}),d.on("send-to-"+t,(e=>{console.log(s,"-接收到消息"),u(o,"receive",e)})),u(o,"receive",JSON.stringify({message:"zhanggp to admin",from:"5df64ca405bd4319e4ebcdcb",to:"5e5b84d286b3d9239c0b61c1"})),e.body=o})),n.post("/send",(async e=>{let{to:t,message:s}=e.request.body,o=e.session.UserInfo._id,n=a(),r={message:s,from:o,to:t,date:{string:n.format("YYYY-MM-DD HH:mm:ss"),year:n.get("year"),month:n.get("month"),date:n.get("date"),hour:n.get("hour"),minute:n.get("minute"),second:n.get("second"),ms:n.get("millisecond")}};await i.insert(c,r).then((t=>{e.body={...r,type:"send"}}))})),n.post("/previous",(async e=>{let{_id:t,to:s}=e.request.body;await i.find(c,{$or:[{from:t,to:s},{from:s,to:t}]}).then((t=>{e.body=t}))})),e.exports=n},7331:(e,t,s)=>{s(5747),s(5622);const o=s(6757)(),n=s(9575).instance(),a=(s(6658),s(2884));o.post("/dialog",(async e=>{const t=e.session.UserInfo._id,{to:s,user:o}=e.request.body,r={header:{font:{sz:16,bold:!0}}},i=[[{value:"您和"+o.name+"的聊天记录",style:r.header}]],c={from:{displayName:"发送人",headerStyle:r.header,cellFormat:function(e,s){return e==t?"您说：":o.name+"说："},width:120},message:{displayName:"内容",headerStyle:r.header,width:300},date:{displayName:"时间",headerStyle:r.header,cellFormat:function(e,t){return e.string},width:200}},d=[{start:{row:1,column:1},end:{row:1,column:3}}];try{await n.find("dialog",{$or:[{from:t,to:s},{from:s,to:t}]}).then((t=>{const s=a.buildExport([{name:"Report",heading:i,merges:d,specification:c,data:t}]);e.body=s}))}catch(e){console.log(e)}})),e.exports=o},3896:(e,t,s)=>{const o=s(5747),n=s(5622),a=s(6757)(),r=(s(9575).instance(),s(6658));s(9515),a.post("/get",(async e=>{let t=[];o.readdirSync(n.join(__dirname+"/../../../files/ebook")).forEach((e=>{t.push({path:`http://${r.host}:${r.port}/ebook/${e}`,name:e})})),e.body=t})),a.post("/remove",(async e=>{let{name:t}=e.request.body;const s=n.join(__dirname+"/../../../files/ebook/"+t);o.existsSync(s)?(o.unlinkSync(s),e.body={status:1,message:t+"已删除！"}):e.body="文件不存在！"})),e.exports=a},174:(e,t,s)=>{s(5747),s(5622);const o=s(6757)(),n=s(9575).instance(),a=(s(6658),s(9515)),r="goods";o.post("/",(async e=>{let t=e.request.body,{pageNum:s,pageSize:o}=t,i=(s-1)*o,c=n.Find_id(a.Omit(t,["pageNum","pageSize"]));await n.connect().then((async t=>{let s=await t.collection(r).find(c).skip(i).limit(o).toArray(),n=await t.collection(r).countDocuments();e.body={list:s,total:n}}))})),o.post("/add",(async e=>{let t=e.request.body;await n.insert(r,{...t}).then((t=>{e.body=t}))})),o.post("/del",(async e=>{let{_id:t}=e.request.body;await n.remove(r,{_id:n.ObjectId(t)}).then((t=>{e.body=t}))})),o.post("/edit",(async e=>{const t=e.request.body,{_id:s}=t;let o=a.Omit(t,["_id"]);await n.update(r,{_id:n.ObjectId(s)},o).then((t=>{e.body=t}))})),o.post("/find",(async e=>{let{_id:t}=e.request.body;await n.find(r,{_id:n.ObjectId(t)}).then((t=>{e.body=t}))})),o.post("/query",(async e=>{let t=e.request.body,{pageNum:s,pageSize:o,category:i}=t,c=(s-1)*o,d=n.Find_id(a.Omit(t,["pageNum","pageSize","category"]));await n.connect().then((async t=>{let s=await t.collection(r).find({...d,category:{$elemMatch:{$eq:i}}}).skip(c).limit(o).toArray(),n=await t.collection(r).countDocuments();e.body={list:s,total:n}}))})),e.exports=o},9548:(e,t,s)=>{const o=s(6757)(),n=s(9575).instance(),a=s(9722),{secret:r}=s(6658);o.post("/",(async e=>{const{userName:t,password:s}=e.request.body;let o={};if(await n.find("user",{$or:[{name:t,password:s},{email:t,password:s}]}).then((e=>{o=e.length>0?e.length>1?{status:-1,tips:"用户异常不允许登录"}:{status:1,...e[0]}:{status:0,tips:"用户名或密码错误！"}})),1===o.status){let{roles:t}=o;await n.find("roles",{name:t}).then((t=>{t[0]?o.permissions=t[0].permissions:o.permissions=[],e.session.UserInfo=o;const s=a.sign({_id:o._id},r,{expiresIn:3600});e.body={token:s,...o}}))}else e.body=o})),e.exports=o},9024:(e,t,s)=>{const o=s(6757)(),n=s(9575).instance(),a=s(9515),r="menu";o.get("/",(async e=>{const{UserInfo:t}=e.session,{permissions:s}=t;await n.find(r,{key:{$in:s}}).then((t=>{e.body=t}))})),o.get("/all",(async e=>{await n.find(r,{}).then((t=>{e.body=t}))})),o.post("/add",(async e=>{let t=e.request.body;await n.insert(r,{...t,key:(new Date).getTime().toString()}).then((t=>{e.body=t}))})),o.post("/del",(async e=>{let{_id:t}=e.request.body;await n.remove(r,{_id:n.ObjectId(t)}).then((t=>{e.body=t}))})),o.post("/edit",(async e=>{const t=e.request.body,{_id:s}=t;let o=a.Omit(t,["_id"]);await n.update(r,{_id:n.ObjectId(s)},o).then((t=>{e.body=t}))})),o.post("/find",(async e=>{let{_id:t}=e.request.body;await n.find(r,{_id:n.ObjectId(t)}).then((t=>{e.body=t}))})),e.exports=o},5616:(e,t,s)=>{const o=s(6757)(),n=s(9575).instance(),a=s(9515),r="roles";o.post("/",(async e=>{await n.find(r).then((t=>{e.body=t}))})),o.post("/add",(async e=>{let t=e.request.body;await n.insert(r,{...t}).then((t=>{e.body=t}))})),o.post("/del",(async e=>{let{_id:t}=e.request.body;await n.remove(r,{_id:n.ObjectId(t)}).then((t=>{e.body=t}))})),o.post("/edit",(async e=>{const t=e.request.body,{_id:s}=t;let o=a.Omit(t,["_id"]);await n.update(r,{_id:n.ObjectId(s)},o).then((t=>{e.body=t}))})),o.post("/find",(async e=>{let{_id:t}=e.request.body;await n.find(r,{_id:n.ObjectId(t)}).then((t=>{e.body=t}))})),e.exports=o},9862:(e,t,s)=>{const o=s(6757)(),n=s(9575).instance();s(9515),o.post("/password",(async e=>{let{name:t,oldPassword:s,newPassword:o}=e.request.body,{_id:a}=e.session.UserInfo;await n.connect().then((async r=>{let i=await r.collection("user").findOneAndUpdate({$or:[{_id:n.ObjectId(a),name:t,password:s},{_id:n.ObjectId(a),email:t,password:s}]},{$set:{password:o}},{});e.body={status:i.ok}}))})),o.post("/address",(async e=>{let{level:t}=e.request.body;const s=["","p_num","city_num","county_num","town_num","details_num"];await n.find("address").then((o=>{if(5!==t){t=t||3;let n=[],a=[];return o.forEach(((e,o)=>{if(-1===n.indexOf(e[s[t]])){n.push(e[s[t]]);let o={};o={ID:e.ID,province:e.province,p_num:e.p_num},2===t&&(o.city_name=e.city_name,o.city_num=e.city_num),3===t&&(o.county_name=e.county_name,o.county_num=e.county_num),4===t&&(o.town__name=e.town__name,o.town_num=e.town_num),a.push(o)}})),void(e.body=a)}e.body=o}))})),e.exports=o},3895:(e,t,s)=>{s(5747),s(5622);const o=s(6757)(),n=s(9575).instance(),a=(s(6658),s(9515)),r="tickets";o.post("/add",(async e=>{let{user:t,goods:s,counts:o}=e.request.body;await n.find("goods",{_id:n.ObjectId(s)}).then((async i=>{i.length>0&&await n.connect().then((async n=>{let c=await n.collection(r).findOneAndUpdate({user:t,goods:s,pay:!1,...a.Omit(i[0],"_id")},{$inc:{counts:o}},{upsert:!0});e.body={status:c.ok,message:1===c.ok?"添加成功":"添加失败"}}))}))})),o.post("/del",(async e=>{let t=[],{_id:s}=e.request.body;s.forEach(((e,s)=>{t[s]={_id:n.ObjectId(e)}})),await n.clear(r,{$or:t}).then((t=>{const s=t.result;e.body={status:s.ok,message:1===s.ok?"删除成功":"删除失败"}}))})),o.post("/clear",(async e=>{let{_id:t}=e.request.body;await n.clear(r,{user:t}).then((t=>{const s=t.result;e.body={status:s.ok,message:1===s.ok?"清空成功":"清空失败"}}))})),o.post("/find",(async e=>{let{_id:t}=e.request.body;await n.find(r,{_id:n.ObjectId(t)}).then((t=>{e.body=t}))})),o.post("/query",(async e=>{let t=e.request.body,{pageNum:s,pageSize:o}=t,i=(s-1)*o,c=a.Omit(t,["pageNum","pageSize"]);await n.connect().then((async t=>{let s=await t.collection(r).find(c).skip(i).limit(o).toArray(),n=await t.collection(r).countDocuments();e.body={list:s,total:n}}))})),o.post("/account",(async e=>{let{_id:t,list:s,counts:o,total:a}=e.request.body;await n.connect().then((async i=>{s.forEach((async(e,t)=>{await i.collection(r).findOneAndUpdate({_id:n.ObjectId(e)},{$set:{pay:!0,counts:o[t]}})}));let c=await i.collection("user").findOneAndUpdate({_id:n.ObjectId(t)},{$inc:{balance:-a}});e.body={status:c.ok,message:1===c.ok?"支付成功":"支付失败"}}))})),o.post("/buy",(async e=>{let{user:t,goods:s,counts:o,price:i}=e.request.body;await n.connect().then((async e=>{await e.collection("user").findOneAndUpdate({_id:n.ObjectId(t)},{$inc:{balance:-o*i}})})),await n.find("goods",{_id:n.ObjectId(s)}).then((async o=>{o.length>0&&await n.insert(r,{user:t,goods:s,pay:!0,...a.Omit(o[0],"_id")}).then((t=>{const s=t.result;e.body={status:s.ok,message:1===s.ok?"支付成功":"支付失败"}}))}))})),e.exports=o},663:(e,t,s)=>{const o=s(5747),n=s(5622),a=s(6757)(),r=s(9575).instance(),i=s(6658),c=s(9515);a.post("/avatar",(async e=>{const{_id:t}=e.request.body||e.session.UserInfo,s=e.request.files.file,a=o.createReadStream(s.path);let c=t+n.extname(s.name),d=n.join(__dirname,"../../../files/avatar/")+c;const u=o.createWriteStream(d);a.pipe(u),await r.update("user",{_id:r.ObjectId(t)},{avatar:`http://${i.host}:${i.port}/avatar/${c}`}).then((e=>{})),e.body={status:1,message:"头像上传成功！",path:`http://${i.host}:${i.port}/avatar/${c}`}})),a.post("/carousel",(async e=>{const t=e.request.files.file,s=o.createReadStream(t.path);let a=c.GetKey(36,10)+"-"+(new Date).getTime()+n.extname(t.name),r=n.join(__dirname,"../../../files/carousel/")+a;const d=o.createWriteStream(r);s.pipe(d),e.body={status:1,message:"头像上传成功！",path:`http://${i.host}:${i.port}/carousel/${a}`}})),e.exports=a},5764:(e,t,s)=>{const o=s(6757)(),n=s(9575).instance(),a=s(9515),r="user";o.post("/",(async e=>{let t=e.request.body,{pageNum:s,pageSize:o}=t,i=(s-1)*o,c=n.Find_id(a.Omit(t,["pageNum","pageSize"]));await n.connect().then((async t=>{let s=await t.collection(r).find(c).skip(i).limit(o).toArray(),n=await t.collection(r).countDocuments();e.body={list:s,total:n}}))})),o.post("/add",(async e=>{let t=e.request.body;await n.insert(r,{...t,password:t.password||"123456"}).then((t=>{e.body=t}))})),o.post("/del",(async e=>{let{_id:t}=e.request.body;await n.remove(r,{_id:n.ObjectId(t)}).then((t=>{e.body=t}))})),o.post("/edit",(async e=>{const t=e.request.body,{_id:s}=t;let o=a.Omit(t,["_id"]);await n.update(r,{_id:n.ObjectId(s)},o).then((t=>{e.body=t}))})),o.post("/find",(async e=>{let{_id:t}=e.request.body;await n.find(r,{_id:n.ObjectId(t)}).then((t=>{e.body=t}))})),e.exports=o},5072:(e,t,s)=>{const o=s(6757)(),n=s(9575).instance(),a=s(2470);o.post("/message",(async e=>{let t=e.request.body;await n.insert("message",{...t,date:a().format("YYYY-MM-DD HH:mm:ss")}).then((t=>{e.body="succ"}))})),e.exports=o},7391:(e,t,s)=>{const o=s(6757)(),n=s(4103),a=s(5747).readFileSync("./template/index.template.html","utf-8"),r=s(7136).createRenderer({template:a});o.get("/vue-server-render-index",(async e=>{const t=new n({data:{url:e.url},template:"<div>访问的 URL 是： {{ url }}</div>"});r.renderToString(t,{title:"vue ssr",metas:'\n            <meta name="keyword" content="vue,ssr">\n            <meta name="description" content="vue srr demo">\n        '},((t,s)=>{e.body=t||""+s}))})),e.exports=o},9363:(e,t,s)=>{const o=new(s(9650));e.exports={io:o,onconnection:function(e,t){console.log(t)},onmessage:function(e,t){console.log(t)}}},9515:(e,t,s)=>{s(6658);const o=function(e,t){e.forEach(((s,a)=>{const r=n(t,s.value),i=r[0],c=r[1];e[a].children=[...i],i.length>0&&c.length>0&&o(i,c)}))},n=function(e,t){let s=[],o=[];return e.forEach(((e,n)=>{e.parentKey===t?s.push(e):o.push(e)})),[s,o]};e.exports={Omit:function(e,t){if(!t)return e;let s=Object.keys(e),o={},n="string"==typeof t?[t]:t;return s.forEach((t=>{-1===n.indexOf(t)&&(o[t]=e[t])})),o},GetKey:function(e,t){let s=e||26,o=t||4,n=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z",1,2,3,4,5,6,7,8,9,0],a="";for(let e=0;e<o;e++){let e=n[Math.floor(Math.random()*s)].toString();Math.random()>.5&&(e=e.toUpperCase()),a+=e}return a},Tree:{root:function(e){let t=[],s=[];return e.forEach(((e,o)=>{e.parentKey?s.push({_id:e._id,title:e.text,value:e.key,key:e.key,icon:e.icon,ico:e.ico,color:e.color,children:[],parentKey:e.parentKey}):t.push({_id:e._id,title:e.text,value:e.key,key:e.key,icon:e.icon,ico:e.ico,color:e.color,children:[]})})),[t,s]},find:n,loop:o},SSRParse:function(e,t){let s=e.toString();return s.match(/<ssr[^>]*>(?:.|[\r\n])*?<\/ssr>/g).forEach((function(e,o,n){let a=function(e,t){return new Function("data",e)(t)}(e.replace(/<ssr>|<\/ssr>/g,"").trim(),t);s=s.replace(e,a)})),s}}},2764:(e,t,s)=>{const o=s(6757)(),n=(s(9575).instance(),s(2470));let a={};o.all("/api/ws/dialog/:id",(e=>{let t=e.params.id;if(a[t]=e.websocket,!e.websocket)throw new Error("请将WebSocket注入Context");e.websocket.send(JSON.stringify({message:"链接成功",from:"server",to:"client"})),e.websocket.on("message",(e=>{let{to:t,message:s,from:o}=JSON.parse(e),r=n(),i={to:t,from:o,message:s,date:{string:r.format("YYYY-MM-DD HH:mm:ss"),year:r.get("year"),month:r.get("month"),date:r.get("date"),hour:r.get("hour"),minute:r.get("minute"),second:r.get("second"),ms:r.get("millisecond")}};a[t]&&a[t].send(JSON.stringify(i))}))})),e.exports=o},8614:e=>{"use strict";e.exports=require("events")},5747:e=>{"use strict";e.exports=require("fs")},8605:e=>{"use strict";e.exports=require("http")},7211:e=>{"use strict";e.exports=require("https")},9722:e=>{"use strict";e.exports=require("jsonwebtoken")},1639:e=>{"use strict";e.exports=require("koa")},7295:e=>{"use strict";e.exports=require("koa-art-template")},5775:e=>{"use strict";e.exports=require("koa-body")},4931:e=>{"use strict";e.exports=require("koa-jwt")},2567:e=>{"use strict";e.exports=require("koa-logger")},6757:e=>{"use strict";e.exports=require("koa-router")},2011:e=>{"use strict";e.exports=require("koa-session")},9650:e=>{"use strict";e.exports=require("koa-socket-2")},8047:e=>{"use strict";e.exports=require("koa-sslify")},8835:e=>{"use strict";e.exports=require("koa-static")},332:e=>{"use strict";e.exports=require("koa-websocket")},2470:e=>{"use strict";e.exports=require("moment")},7548:e=>{"use strict";e.exports=require("mongodb")},366:e=>{"use strict";e.exports=require("mysql")},2884:e=>{"use strict";e.exports=require("node-excel-export")},85:e=>{"use strict";e.exports=require("node-xlsx")},5622:e=>{"use strict";e.exports=require("path")},2413:e=>{"use strict";e.exports=require("stream")},1669:e=>{"use strict";e.exports=require("util")},4103:e=>{"use strict";e.exports=require("vue")},7136:e=>{"use strict";e.exports=require("vue-server-renderer")}},t={};function o(s){if(t[s])return t[s].exports;var n=t[s]={exports:{}};return e[s](n,n.exports,o),n.exports}(()=>{const e=o(5622),t=o(5747),s=(o(8605),o(7211)),n=o(1669),a=o(1639),r=o(5775),i=o(8835),c=o(7295),d=o(2011),u=o(332),l=(o(8047).default,o(2567),o(9722)),p=o(4931),y=n.promisify(l.verify),m=u(new a),h=o(1174),b=o(2764),f=o(6658),{io:w,onmessage:g,onconnection:_,srouter:q}=o(9363),k={key:t.readFileSync("./4805274_zhanggp.top.key"),cert:t.readFileSync("./4805274_zhanggp.top.pem")};m.keys=f.keys,c(m,{root:e.join(__dirname,"/template"),extname:".html",debug:!1}),m.use(r({multipart:!0,formidable:{maxFileSize:209715200}})),m.use(d(f.session,m)),m.use(i(e.join(__dirname+"/static"))),m.use(i(e.join(__dirname+"/files"))),m.use(p({secret:f.secret,passthrough:!0}).unless({path:[]})),m.use((async(e,t)=>{const{authentication:s}=e.request.headers;switch(s){case"JWT":const s=e.request.headers[f.TokenKey];if(-1===f.JWTAccess.indexOf(e.url));else try{await y(s.split(" ")[1],f.secret)}catch(t){if(t.name)switch(t.name){case"TokenExpiredError":e.throw(401,"长时间未登录，请重新登录！");break;case"JsonWebTokenError":e.throw(401,"请先登录！");break;case"NotBeforeError":default:e.throw(401,t.message)}e.throw(401)}await t();break;default:let o=e.url,n=o.indexOf("#"),a=o.indexOf("?");-1!==n&&(o=o.slice(0,n-1)),-1!==a&&(o=o.slice(0,a)),o.endsWith("/")&&(o=o.slice(0,-1)),-1!==f.DirectAccess.indexOf(o)||e.session.UserInfo?await t():e.throw(401)}})),m.use(h.routes()),m.use(h.allowedMethods()),m.ws.use(b.routes()),m.listen(f.port),s.createServer(k,m.callback()).listen(443),console.log("port:"+f.port)})()})();